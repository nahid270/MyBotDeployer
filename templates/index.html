<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Bot Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-dark text-white">

<div class="container mt-5">
    <h1 class="text-center mb-4">ü§ñ Smart Multi-Bot Manager</h1>

    <!-- Deploy Form -->
    <div class="card bg-secondary text-white mb-5">
        <div class="card-header">Deploy New Bot</div>
        <div class="card-body">
            <form action="/deploy" method="POST">
                <div class="mb-3">
                    <input type="text" name="repo_link" class="form-control" placeholder="GitHub Repo Link" required>
                </div>
                <div class="mb-3">
                    <input type="text" name="start_file" class="form-control" placeholder="Start File (e.g. main.py) - Optional">
                </div>
                <button type="submit" class="btn btn-success w-100">üöÄ Deploy & Auto-Install</button>
            </form>
        </div>
    </div>

    <!-- Live Status Table -->
    <h3 class="mb-3">Live Bot Status <span id="loading" style="font-size: 0.6em; color: yellow;">(Auto-updating...)</span></h3>
    <table class="table table-dark table-hover">
        <thead>
            <tr>
                <th>Bot Name</th>
                <th>Status</th> <!-- ‡¶è‡¶ñ‡¶® ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá -->
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="bot-table-body">
            <!-- JavaScript data will load here -->
        </tbody>
    </table>
</div>

<script>
    function updateStatus() {
        $.getJSON('/status', function(data) {
            let rows = '';
            if(data.length === 0) {
                rows = '<tr><td colspan="3" class="text-center">No bots deployed yet.</td></tr>';
            } else {
                $.each(data, function(key, bot) {
                    // Status Color Code
                    let statusColor = bot.status.includes("Running") ? "text-success" : 
                                      bot.status.includes("Installing") ? "text-warning" : 
                                      bot.status.includes("Cloning") ? "text-info" : "text-danger";

                    // Action Buttons Logic
                    let actionBtn = '';
                    if (bot.status.includes("Running")) {
                        actionBtn = `<a href="/stop/${bot.name}" class="btn btn-warning btn-sm">üõë Stop</a>`;
                    } else {
                        actionBtn = `<button class="btn btn-secondary btn-sm" disabled>Stopped</button>`;
                    }
                    
                    rows += `
                    <tr>
                        <td class="fw-bold">${bot.name}</td>
                        <td class="${statusColor} fw-bold">${bot.status}</td>
                        <td>
                            ${actionBtn}
                            <a href="/delete/${bot.name}" class="btn btn-danger btn-sm ms-1">üóëÔ∏è Delete</a>
                        </td>
                    </tr>`;
                });
            }
            $('#bot-table-body').html(rows);
        });
    }

    // ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡ß® ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶™‡¶∞ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá
    setInterval(updateStatus, 2000);
    updateStatus(); // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞ ‡¶≤‡ßã‡¶°
</script>

</body>
</html>
