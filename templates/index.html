<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Bot Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { background-color: #121212; color: #eee; font-family: sans-serif; }
        .card { background-color: #1e1e1e; border: 1px solid #333; }
        .form-control { background-color: #2c2c2c; border: 1px solid #444; color: white; }
        .form-control:focus { background-color: #333; color: white; }
        .table { color: #ddd; }
        .table-hover tbody tr:hover { background-color: #252525; }
    </style>
</head>
<body>

<div class="container mt-5">
    <h1 class="text-center mb-4">üöÄ Ultimate Bot & Web Manager</h1>

    <!-- Deploy Section -->
    <div class="card mb-5 shadow-lg">
        <div class="card-header bg-primary text-white fw-bold">Deploy New App</div>
        <div class="card-body">
            <form action="/deploy" method="POST">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label>GitHub Repo Link</label>
                        <input type="text" name="repo_link" class="form-control" placeholder="https://github.com/..." required>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label>Start File (Optional)</label>
                        <input type="text" name="start_file" class="form-control" placeholder="app.py / main.py">
                    </div>
                    <div class="col-md-3 mb-3">
                        <label>Custom Port (Optional)</label>
                        <input type="number" name="custom_port" class="form-control" placeholder="e.g. 5000">
                    </div>
                </div>
                <button type="submit" class="btn btn-success w-100 fw-bold">‚ö° Deploy Now</button>
            </form>
        </div>
    </div>

    <!-- Active List -->
    <h3 class="mb-3">Active Deployments</h3>
    <div class="table-responsive">
        <table class="table table-dark table-hover rounded overflow-hidden">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Internal Port</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="bot-table-body">
                <tr><td colspan="4" class="text-center">Loading...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    function updateStatus() {
        $.getJSON('/status', function(data) {
            let rows = '';
            if(data.length === 0) {
                rows = '<tr><td colspan="4" class="text-center text-secondary">No active deployments.</td></tr>';
            } else {
                $.each(data, function(key, bot) {
                    let statusClass = bot.status.includes("Running") ? "text-success" : "text-warning";

                    // ‡¶¨‡¶æ‡¶ü‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï
                    let mainBtn = '';
                    let webBtn = '';

                    if (bot.running) {
                        mainBtn = `<a href="/stop/${bot.name}" class="btn btn-warning btn-sm fw-bold">üõë Stop</a>`;
                        // ‡¶Ø‡¶¶‡¶ø ‡¶∞‡¶æ‡¶®‡¶ø‡¶Ç ‡¶•‡¶æ‡¶ï‡ßá, ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶ì‡ßü‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶Ü‡¶∏‡¶¨‡ßá
                        webBtn = `<a href="/view/${bot.name}/" target="_blank" class="btn btn-info btn-sm fw-bold ms-1">üîó Open Web</a>`;
                    } else {
                        mainBtn = `<a href="/start/${bot.name}" class="btn btn-success btn-sm fw-bold">‚ñ∂Ô∏è Start</a>`;
                        webBtn = `<button class="btn btn-secondary btn-sm ms-1" disabled>üîó Web</button>`;
                    }
                    
                    rows += `
                    <tr>
                        <td class="fw-bold">${bot.name}</td>
                        <td class="text-info">${bot.port}</td>
                        <td class="${statusClass} fw-bold">${bot.status}</td>
                        <td>
                            ${mainBtn}
                            ${webBtn}
                            <a href="/delete/${bot.name}" class="btn btn-danger btn-sm ms-1">üóëÔ∏è Delete</a>
                        </td>
                    </tr>`;
                });
            }
            $('#bot-table-body').html(rows);
        });
    }
    setInterval(updateStatus, 2000);
    updateStatus();
</script>

</body>
</html>
