<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Bot Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { background-color: #1a1a1a; color: #f0f0f0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card { background-color: #2d2d2d; border: none; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .form-control { background-color: #3d3d3d; border: 1px solid #555; color: white; }
        .form-control:focus { background-color: #444; color: white; border-color: #28a745; box-shadow: none; }
        .btn-success { background-color: #28a745; border: none; }
        .table { color: #ccc; }
        .table-hover tbody tr:hover { color: white; background-color: #333; }
        thead { background-color: #000; }
    </style>
</head>
<body>

<div class="container mt-5">
    <h1 class="text-center mb-4">üéõÔ∏è Advanced Bot Controller</h1>

    <!-- Deploy Section -->
    <div class="card mb-5">
        <div class="card-header bg-dark text-success fw-bold">Deploy New Bot</div>
        <div class="card-body">
            <form action="/deploy" method="POST">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">GitHub Link</label>
                        <input type="text" name="repo_link" class="form-control" placeholder="https://github.com/..." required>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Start File (Opt)</label>
                        <input type="text" name="start_file" class="form-control" placeholder="e.g. bot.py">
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label text-warning">Custom Port (Opt)</label>
                        <input type="number" name="custom_port" class="form-control" placeholder="e.g. 5000">
                    </div>
                </div>
                <button type="submit" class="btn btn-success w-100 fw-bold">‚ö° Initialize & Deploy</button>
            </form>
        </div>
    </div>

    <!-- Live Status Table -->
    <h3 class="mb-3">Active Instances <span id="loading" style="font-size: 0.5em; color: #888;">(Auto-refreshing...)</span></h3>
    <div class="table-responsive">
        <table class="table table-dark table-striped table-hover rounded">
            <thead>
                <tr>
                    <th>Bot Name</th>
                    <th>Port</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="bot-table-body">
                <tr><td colspan="4" class="text-center">Loading data...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    function updateStatus() {
        $.getJSON('/status', function(data) {
            let rows = '';
            if(data.length === 0) {
                rows = '<tr><td colspan="4" class="text-center text-secondary">No bots found. Deploy one above!</td></tr>';
            } else {
                $.each(data, function(key, bot) {
                    let statusClass = "text-danger";
                    if(bot.status.includes("Running")) statusClass = "text-success";
                    else if(bot.status.includes("Installing") || bot.status.includes("Cloning") || bot.status.includes("Starting")) statusClass = "text-warning";

                    // Start/Stop Button Logic
                    let toggleBtn = '';
                    if (bot.running) {
                        toggleBtn = `<a href="/stop/${bot.name}" class="btn btn-warning btn-sm fw-bold">üõë Stop</a>`;
                    } else {
                        // ‡¶∏‡ßç‡¶ü‡¶™ ‡¶ï‡¶∞‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá Start ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
                        toggleBtn = `<a href="/start/${bot.name}" class="btn btn-success btn-sm fw-bold">‚ñ∂Ô∏è Start</a>`;
                    }
                    
                    rows += `
                    <tr>
                        <td class="fw-bold text-white">${bot.name}</td>
                        <td class="text-info">${bot.port}</td>
                        <td class="${statusClass} fw-bold">${bot.status}</td>
                        <td>
                            ${toggleBtn}
                            <a href="/delete/${bot.name}" class="btn btn-danger btn-sm ms-2">üóëÔ∏è Delete</a>
                        </td>
                    </tr>`;
                });
            }
            $('#bot-table-body').html(rows);
        });
    }
    setInterval(updateStatus, 2000);
    updateStatus();
</script>

</body>
</html>
